# シフト自動化システム - Google Apps Script

従業員のシフト希望を集約し、毎朝自動でSlackに投稿するシステムです。GAS（Google Apps Script）を使用して属人化を防ぎ、スケーラブルな運用が可能です。

## 🌟 特徴

- **完全自動化**: 毎朝10時に自動でシフト集約・Slack投稿
- **属人化防止**: GASを使用してサーバーレスで運用
- **柔軟な勤務形態**: 店舗出勤・在宅勤務に対応
- **承認フロー**: マネージャーによる承認システム
- **休み管理**: 「休み」のシフトは特別表示
- **CSV出力**: 詳細データをGoogleドライブに保存

## 📋 システム構成

```
従業員個人シート → マスター集約シート → GAS → Slack投稿
     ↓                    ↓
  シフト希望入力      承認済みシフト集約
```

## 🚀 クイックスタート

### 1. 必要な準備

- Googleアカウント
- Slackワークスペース
- Googleスプレッドシート

### 2. セットアップ

1. **マスター集約シートを作成**
   - 新しいGoogleスプレッドシートを作成
   - 3つのシートを作成：`config`, `aggregated_shifts`, `logs`

2. **従業員用シートを作成**
   - 従業員数分のスプレッドシートを作成
   - 各シートに`request`シートを作成

3. **GASスクリプトを配置**
   - マスター集約シートで「拡張機能」→「Apps Script」
   - `gas_aggregation_script.js`の内容を貼り付け

4. **設定とテスト**
   - Slack Webhook URLを設定
   - プロパティを設定
   - テスト実行

詳細な手順は[セットアップガイド](SETUP_GUIDE.md)をご覧ください。

## 📁 ファイル構成

```
├── gas_aggregation_script.js    # GASスクリプト（メイン）
├── employee_shift_template.py    # 従業員テンプレート作成
├── master_aggregation_sheet.py  # マスターシート作成
├── setup_shift_automation.py    # 自動セットアップ
├── SHIFT_AUTOMATION_GUIDE.md    # 詳細ガイド
├── SETUP_GUIDE.md              # セットアップガイド
└── README.md                    # このファイル
```

## 📊 従業員用シートの仕様

### 必須列構成

| 列 | 列名 | データ型 | 説明 | 例 |
|---|---|---|---|---|
| A | employee_id | テキスト | 従業員ID（固定値） | EID-001 |
| B | employee_name | テキスト | 従業員名（固定値） | 山田太郎 |
| C | store | プルダウン | 店舗 | 東京, 大阪, 在宅 |
| D | role | プルダウン | 役職 | 販売, 受付, 事務 |
| E | date | 日付 | 希望日 | 2025-11-01 |
| F | start_time | 時刻 | 開始時間 | 10:00 |
| G | end_time | 時刻 | 終了時間 | 19:00 |
| H | break_min | 数値 | 休憩時間（分） | 60 |
| I | shift_type | プルダウン | シフトタイプ | 通常, 早番, 遅番, 休み |
| J | work_content | テキスト | 業務内容 | レジ業務、商品陳列 |
| K | notes | テキスト | 備考・希望 | 学校行事の都合で... |
| L | status | プルダウン | 承認ステータス | 承認, 確認中, 非承認 |
| M | manager | テキスト | 承認者名 | 佐藤 |
| N | approved_at | 日時 | 承認日時 | 2025-10-25 14:05 |

### データ検証ルール

- **店舗**: 東京, 大阪, 名古屋, 在宅
- **役職**: 販売, 受付, 事務, 管理, アルバイト
- **シフトタイプ**: 通常, 早番, 遅番, 休み, 特別勤務
- **承認ステータス**: 承認, 確認中, 非承認
- **日付**: 未来日のみ入力可能

## 🏢 マスター集約シートの仕様

### `config`シート

| A | B | C | D | E | F | G | H | I |
|---|---|---|---|---|---|---|---|---|
| employee_id | employee_name | spreadsheet_id | role | slack_webhook_url | notification_time | status | last_updated | notes |

### `aggregated_shifts`シート（自動生成）

承認済みのシフトデータが自動で集約されます。

### `logs`シート（自動生成）

システムの実行ログが自動で記録されます。

## 📱 Slack投稿例

```
🌅 おはようございます！
📅 2025-11-01(土)のシフト集約結果 📅

📊 合計 5件の勤務シフトが承認されています
😴 2名が休みです

🏪 東京店
🕐 09:00-18:00: 山田太郎 (販売) - レジ業務、商品陳列
🕐 10:00-19:00: 鈴木次郎 (受付) - 顧客対応、電話受付

🏪 大阪店  
🕐 10:30-19:30: 佐藤花子 (販売) - レジ業務、在庫管理

🏠 在宅
🕐 09:00-17:00: 田中一郎 (事務) - 資料作成、データ入力

📁 詳細CSVファイル: https://drive.google.com/...

💪 今日も一日頑張りましょう！
```

## 🔄 運用フロー

### 従業員側
1. 個人シートでシフト希望を入力
2. 締切日までに入力完了
3. マネージャーからの承認待ち

### マネージャー側
1. 各従業員のシフト希望を確認
2. 承認/却下を決定
3. `status`列を`承認`に変更
4. `manager`と`approved_at`を記録

### システム側
1. 毎朝10時に自動実行
2. 全従業員シートから`承認`のシフトを集約
3. CSVファイルをGoogleドライブに保存
4. Slackに投稿（リンク付き）

## ⚙️ GASスクリプトの設定

### プロパティ設定

```javascript
SLACK_WEBHOOK_URL = 'https://hooks.slack.com/services/YOUR_WEBHOOK_URL'
SLACK_CHANNEL = '#リモートチーム勤怠報告'
DRIVE_FOLDER_ID = 'YOUR_DRIVE_FOLDER_ID'  // 任意
```

### トリガー設定

- **実行関数**: `aggregateShiftsAndPostToSlack`
- **イベント**: 時間主導型
- **時刻**: 毎日 午前10時（日本時間）

## 🛠️ カスタマイズ

### 通知時間の変更
トリガー設定で時刻を変更可能

### 投稿チャンネルの変更
プロパティでチャンネルを変更可能

### 店舗の追加
従業員シートのプルダウン選択肢を編集

### シフトタイプの追加
従業員シートのプルダウン選択肢を編集

## 🔒 セキュリティ考慮事項

1. **アクセス権限**
   - 従業員は自分のシートのみ編集可能
   - マネージャーは全シート閲覧・承認可能

2. **データ保護**
   - 個人情報は最小限に留める
   - 共有リンクの有効期限設定

3. **監査ログ**
   - すべての操作をログに記録
   - 定期的なログ確認

## 📈 拡張機能

- 店舗別CSVファイル生成
- メール通知
- シフト重複チェック
- 勤務時間集計

## 🐛 トラブルシューティング

### よくある問題

1. **認証エラー**
   - サービスアカウントキーファイルのパスを確認
   - 必要な権限が付与されているか確認

2. **Slack投稿が失敗**
   - Webhook URLが正しいか確認
   - チャンネル名が正しいか確認

3. **従業員シートが読み込めない**
   - スプレッドシートIDが正しいか確認
   - シート名が`request`になっているか確認
   - 共有権限が適切に設定されているか確認

### ログの確認

マスターシートの`logs`シートで実行ログを確認できます。

## 📞 サポート

システムに関する質問や問題が発生した場合は、以下を確認してください：

1. ログファイル（`logs`シート）
2. エラーメッセージ
3. 設定値（プロパティ）

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 🤝 貢献

プルリクエストやイシューの報告を歓迎します。

---

**🎉 シフト管理を自動化して、チームの生産性を向上させましょう！**